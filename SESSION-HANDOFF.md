# Taxonomy Session Handoff

**Date:** February 8, 2026
**Previous Session:** 3a0d5e8f (died — prompt too long at 54 MB)

---

## CRITICAL: Read These First

1. `/Users/tim001/VSCode/HMCG/VSCode-Root-Files/ClaudeNew.md` — Master rules (READ FIRST)
2. `/Users/tim001/VSCode/HMCG/taxonomy.shopnet/TODO.md` — Full status of all items (38 resolved, 2 open, 6 future)

---

## What Was Completed (This Session)

### UID v1→v2 Migration — COMPLETE (S22)
- All 102 UIDs converted (94 sites + 8 agents)
- Schema: VARCHAR(12) → VARCHAR(15)
- Old CHECK `^SN-[0-9]{8}$` dropped, new CHECK `^sn_[0-9a-z]{12}$` added
- ~490 cell updates across 10 tables on 2 RDS instances
- 37 S3 folders renamed (SN- → sn_)
- 163 JSON entries updated in network-endpoints.json
- 189 lines of dead counter code deleted from Connect Gateway (5443 → 5254 lines)
- Zero v1 UIDs remain anywhere
- Backup: `server-backups/server-full-backup-pre-uid-v2-20260208.tar.gz` (74 MB)
- Mapping: `taxonomy.shopnet/uid_migration_mapping.json`

### Other Completed Items
- S5: console.js PLATFORM_OPTIONS fallback updated (4 → 9 infrastructure types)
- S6: "This Is The Law" GUI panel rewritten from v5.0 (1292 → 666 lines)
- S19b: `site_infrastructure` table dropped (orphan)
- S19d: `admin_users` orphan dropped from shopnet_sites
- S19e: 3 dead `site_builds` API endpoints removed (~130 lines)
- S20: 7 orphan agent_type rows removed from SQL
- S24: `github_cards` dead code fully removed (table + 3 API endpoints + 7 JS functions + modal)
- S24a: Stale GitHub library links fixed (THE LAW v4.0→v5.0, Deathstar path)
- D1-D10: All documentation fixes complete
- ThisIsTheLaw_v5.0 created and verified

---

## What Was Being Done When Session Died

Tim said: **"go check everything, run tests, check the pulse system - I see a lot of reds - make sure the test methods work"**

The session hit "prompt too long" before it could complete this check. Last action was querying pulse status and endpoint_taxonomy.

### Immediate TODO:
1. **Check pulse system health** — Tim sees lots of red dots on the console
   ```bash
   ssh -i /Users/tim001/VSCode/Keys/TLemmon.pem ubuntu@34.234.121.248 \
     "curl -s http://127.0.0.1:8000/api/v1/pulse/results -H 'X-API-Key: snc_console_admin_key_2026'"
   ```
2. **Verify all pulse methods still work after UID migration** — site_uids changed format (SN- → sn_), pulse system needs to handle new format
3. **Check if `pulse_status` column exists** — last error was `column "pulse_status" does not exist` (might be `pulse_result` or different name)
4. **Fix any broken pulse checks** — the reds Tim is seeing

---

## What's Left (from TODO.md)

### Open Items (2):
| # | Item | Priority |
|---|------|----------|
| S19 | Document undocumented tables in `shopnet_sites` (7 tables total) | MEDIUM |
| S19a | Document `sites` table (legacy brochure, 48 cols, dual-written) | MEDIUM |
| S19c | Document `taxonomy_hosting_defaults` table | LOW |

### Future (6):
S13 (shopnet_payments DB), S14 (assist.shopnet backend), S15-S17 (taxonomy_definition for CRM/assist/registry), S21 (dynamic CHECKs for remaining constraints)

---

## Key File Locations

| File | Purpose |
|------|---------|
| `/Users/tim001/VSCode/HMCG/taxonomy.shopnet/TODO.md` | Master task tracker |
| `/Users/tim001/VSCode/HMCG/taxonomy.shopnet/ThisIsTheLaw_v5.0_2026-02-07.MD` | Governance document v5.0 |
| `/Users/tim001/VSCode/HMCG/taxonomy.shopnet/UID-Migration-Plan.md` | Migration plan |
| `/Users/tim001/VSCode/HMCG/taxonomy.shopnet/UID-Migration-Scope.md` | Migration scope |
| `/Users/tim001/VSCode/HMCG/taxonomy.shopnet/uid_migration_mapping.json` | v1→v2 UID mapping |
| `/Users/tim001/VSCode/HMCG/connect.shopnet/backend/shopnet_connect_api.py` | Connect Gateway API |
| `/Users/tim001/VSCode/HMCG/connect.shopnet/docs/PulseCleanup.MD` | Pulse cleanup notes |
| `/Users/tim001/VSCode/HMCG/connect.shopnet/docs/PULSE.md` | Pulse documentation |

---

## Live System State (Feb 8, 2026)

```
RDS Instance 1: KPI_Source, amazon_products, shopnet_assist (9 tables), shopnet_connect, shopnet_data, shopnet_sites (7 tables)
RDS Instance 2: shopnet_crm (7 tables), shopnet_registry (3 tables)
uid_registry: 102 UIDs — ALL v2 format (94 sn_, 8 sa_). Zero v1 UIDs remain.
endpoint_taxonomy: 82 rows, site_uid VARCHAR(15), CHECK ^sn_[0-9a-z]{12}$
agents: 8 rows, all v2 format
S3: 37 sn_ folders (0 SN- folders)
Connect Gateway: 5254 lines, v2 generation active
taxonomy_definition: 79 rows, 3 dynamic triggers live
```

---

## Playwright Screenshot Warning

Do NOT take Playwright screenshots on every step. Only screenshot on errors, max 5 total. This session and the previous Deathstar session both died from context bloat.

---

*Generated by Terminal Claude from session 3a0d5e8f analysis*
