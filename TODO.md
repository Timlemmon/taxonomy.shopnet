# SND Taxonomy — Open Items
**Created:** February 7, 2026
**Updated:** February 7, 2026 (LIVE SYSTEM VERIFIED + Documentation fixes applied to D1-D3, S18a, S18b, S23 + S1/S2 auto-generated + S3/S4 deleted)
**Context:** Code exploration across all HMCG repos revealed taxonomy values defined in 8+ files at 3 different version levels. This TODO tracks everything that needs fixing.

**Version Levels Found:**
- **v3.1** (Jan 25, 2026) — `schema_the_law.sql`, `platform-types.js` (2 copies), `seed_the_law.py`
- **v3.5** (Feb 4, 2026) — `console.js` PLATFORM_OPTIONS (original hardcoded)
- **v3.5.1** (Feb 7, 2026) — `update-taxonomy-v3.5.sql`, dynamic trigger, Flask API, `loadPlatformOptions()` — **deployed to production**

**Conflict Resolution:** Most recent version wins. `taxonomy_definition` table on RDS is highest authority. All code should read from it dynamically where possible.

**Scope Tags:**
- `LOCAL CODE` — code file on disk only (safe to edit anytime)
- `LOCAL DOC` — documentation file on disk only (safe to edit anytime)
- `LOCAL+LIVE` — requires both local file edit AND production deployment
- `LIVE` — requires production RDS/server change

**New Source:** `endpoint-taxonomy-update.MD` documents the Feb 7 changes by the other Claude session. Key change: **the system moved from hardcoded to dynamic**. The trigger, console wizard, and Flask API all now read from `taxonomy_definition`. Deployed to production.

---

## PART 1 — SYSTEM FIXES (Code & Infrastructure)

### CRITICAL — Code Files With Wrong Taxonomy Values (Still on v3.1)

These files were NOT touched by the Feb 7 dynamic update. They remain hardcoded on the old v3.1 taxonomy.

| # | File | Location | Current Version | What's Wrong | Status |
|---|------|----------|----------------|--------------|--------|
| ~~S1~~ | ~~`platform-types.js`~~ | `/connect.shopnet/client-module/src/core/platform-types.js` | **AUTO-GENERATED** | **RESOLVED.** File is now auto-generated by `taxonomy.shopnet/generate-platform-types.mjs` which fetches from live `taxonomy_definition` API + local `platform-enrichments.json`. All 35 platform_types correct, 6 endpoint_types, correct NODE codes (W3G,API,RDH,W3S,LLM,OTH), 9 WEBSITE types, CA not CU. `prebuild` hook in package.json runs generator before every build. | **RESOLVED** `LOCAL CODE` |
| ~~S2~~ | ~~`platform-types.js`~~ | `/search.shopnet-module/src/core/platform-types.js` | **AUTO-GENERATED** | **RESOLVED.** Same generator writes both files. `prebuild` hook added to search-module package.json. | **RESOLVED** `LOCAL CODE` |
| ~~S3~~ | ~~`schema_the_law.sql`~~ | ~~`/shopnet.network-console/radius/sql/schema_the_law.sql`~~ | **DELETED** | **RESOLVED.** Files deleted (entire `radius/sql/` directory removed). Were part of dead `radius` module. Not on server, not used by anything. Live RDS has dynamic triggers — no static SQL schema needed. | **RESOLVED** `LOCAL CODE` |
| ~~S4~~ | ~~`seed_the_law.py`~~ | ~~`/shopnet.network-console/radius/sql/seed_the_law.py`~~ | **DELETED** | **RESOLVED.** Deleted with S3. Seeder was v3.1 with old codes. Live `taxonomy_definition` populated by `update-taxonomy-v3.5.sql`. | **RESOLVED** `LOCAL CODE` |

### HIGH — Code Files Partially Out of Date

| # | File | Location | Current Version | What's Wrong | Status |
|---|------|----------|----------------|--------------|--------|
| ~~S5~~ | ~~`console.js` PLATFORM_OPTIONS fallback~~ | `/shopnet.network-console/static/js/console.js` (~line 3814) | v3.5.1 (Feb 7) | **RESOLVED.** Updated I fallback from 4 types (S3B, LMB, SQS, SNS) to all 9 types matching `taxonomy_definition` (added AGW, CF, EC2, LS, RDS). Updated on both live server and local repo. | **RESOLVED** `LOCAL+LIVE` |
| ~~S6~~ | ~~Console GUI "This Is The Law" panel~~ | `/shopnet.network-console/static/index.html` (panel-the-law) | **v5.0** | **RESOLVED.** Complete rewrite from v5.0 master document. Replaced 1292-line panel with 666-line v5.0 panel. Removed legacy L/R codes, added all 35 platform_types grouped by 6 endpoint_types, added Dynamic Taxonomy section, Pulse health check mapping, Superseded Codes table, fixed CO/CP/RD descriptions, updated version to v5.0. Deployed to live server and local repo. | **RESOLVED** `LOCAL+LIVE` |

### RESOLVED — Database/Infrastructure (confirmed by endpoint-taxonomy-update.MD)

| # | Item | Details | Status |
|---|------|---------|--------|
| ~~S7~~ | ~~Verify `update-taxonomy-v3.5.sql` has been run on production RDS~~ | **LIVE VERIFIED.** `taxonomy_definition` has **79 rows** on production (35 platform_types, 6 endpoint_types, 6 website_purpose, 4 managed_by, 2 persistence, 3 status, 2 web_protocol, 10 console_section, 6 runtime, 5 host). **NOTE:** SQL file has ~87 rows (adds 7 agent_type + 1 inactive website_purpose 'gateway') — those 8 rows were never deployed. 3 dynamic triggers live: `validate_endpoint_type()`, `validate_managed_by()`, `validate_platform_type()`. No ND in taxonomy_definition. | **RESOLVED** |
| ~~S8~~ | ~~RDS CHECK constraint~~ | **LIVE VERIFIED.** The `endpoint_type` CHECK constraint was **REMOVED entirely** (not set to W,A,D,N,I,O,ND). Validation is now via dynamic trigger `trg_validate_endpoint_type` which queries `taxonomy_definition`. **Remaining hardcoded CHECKs on live:** `chk_site_uid_format` (v1 only: `^SN-[0-9]{8}$`), `chk_web_protocol` (W2,W3), `chk_status` (planned,wip,live), `chk_persistence` (D,P), `chk_store_checkout` (Y,N), `chk_health_method` (11 pulse methods). | **RESOLVED** (corrected: trigger not CHECK) |

### HIGH — Still Needed

| # | Item | Details | Status |
|---|------|---------|--------|
| ~~S9~~ | ~~Migrate existing `ND` records~~ | **LIVE VERIFIED.** Zero ND records exist on production. 76 endpoints: 53 W, 8 A, 6 D, 8 N, 1 I, 0 O. No migration needed. ND is not in `taxonomy_definition` either — trigger will reject any new ND inserts. | **RESOLVED** |

### RESOLVED — Databases (LIVE VERIFIED Feb 7)

| # | Item | Details | Status |
|---|------|---------|--------|
| ~~S10~~ | ~~Create `shopnet_crm` tables on RDS Instance 2~~ | **LIVE VERIFIED.** Database exists with all 7 tables: `user_taxonomy` (2 rows), `user_profiles` (0), `user_site_registrations` (2), `user_delegations` (1), `user_oauth` (0), `user_wallets` (0), `org_memberships` (0). Has live data. | **RESOLVED** |
| ~~S11~~ | ~~Create `shopnet_registry` tables on RDS Instance 2~~ | **LIVE VERIFIED.** Database exists with all 3 tables: `list_taxonomy` (2 rows), `list_items` (2), `sharing_tokens` (1). Has live data. | **RESOLVED** |
| ~~S12~~ | ~~Create `shopnet_assist` database on RDS Instance 1~~ | **LIVE VERIFIED.** Database exists with all 9 tables: `agents` (8), `agent_rules` (12), `agent_tasks` (0), `agent_permissions` (0), `agent_memory` (0), `agent_learnings` (0), `prompt_templates` (0), `invocation_history` (0), `rule_violations` (0). Has seed data. | **RESOLVED** |

### NEW — Discovered During Live System Verification (Feb 7)

| # | Item | Details | Status |
|---|------|---------|--------|
| ~~S18~~ | ~~`schema_the_law.sql` missing 14 columns from live `endpoint_taxonomy`~~ | **RESOLVED.** The stale SQL file was deleted in S3 (dead radius module). The live `endpoint_taxonomy` table has all 31 columns and is the source of truth. The full CREATE TABLE is documented in ThisIsTheLaw_v5.0 Appendix A. No local SQL schema file needed — live RDS uses dynamic triggers. | **RESOLVED** `LOCAL CODE` |
| ~~S18a~~ | ~~`42-PULSE.md` behind live system~~ | **RESOLVED.** Updated 42-PULSE.md v1.1→v1.2: added 4 missing check types (http_ip, http_web3, github, fileserver, none → 11 total), added 5 result-storage columns to schema section, updated CHECK constraint SQL, updated intervals config. Synced to both library and primary deathstar copies. | **RESOLVED** `LOCAL DOC` |
| ~~S18b~~ | ~~`ThisIsTheLaw_v5.0` needs Pulse module section~~ | **RESOLVED.** Added Section 2.13 "Pulse Health Check Module" to ThisIsTheLaw_v5.0 with reference to 42-PULSE.md as authoritative source, covering 11 check types, 8 pulse columns, API routes, and GUI integration. | **RESOLVED** `LOCAL DOC` |
| ~~S18c~~ | ~~Investigate `agent_type` column on `endpoint_taxonomy`~~ | **RESOLVED.** Two different `agent_type` columns exist — they are NOT the same thing. **`endpoint_taxonomy.agent_type`** (VARCHAR(20), nullable): tracks which client-facing chatbot is *installed on a Website endpoint* (values: `product_assist`, `domain_assist`, `status_agent`, NULL). Only 1 of 76 endpoints uses it (SN-00000067 bestbird.com = "status_agent"). Read by `content_assist/handler.py` (line 449), `dashboard.js` (lines 443-446), `app.py` (line 801). **`shopnet_assist.agents.agent_type`** (VARCHAR(10), NOT NULL): classifies whether an *AI agent itself* is internal or client-facing (values: `internal`, `client`). CHECK constrained. Used by all 8 agents. **Verdict:** Both columns are intentional, serving different purposes. The endpoint_taxonomy column is underutilized but not legacy — it's the mechanism for knowing which sites have embedded chatbots. Keep for now. | **RESOLVED** `LIVE` |
| S19 | Undocumented tables in `shopnet_sites` | Live `shopnet_sites` now has **7 tables** (was 10). The documented THREE-TABLE SCHEMA (`endpoint_taxonomy`, `website_data`, `json_backup`) is correct — 2 additional active tables (`taxonomy_definition`, `taxonomy_hosting_defaults`), 1 legacy dual-written table (`sites`), 1 active non-taxonomy table (`aws_resource_inventory`). Three orphans dropped: `admin_users` (S19d), `github_cards` (S24), `site_infrastructure` (S19b). | **MEDIUM** `LIVE` |
| S19a | `sites` table — brochure content (LEGACY, ACTIVE, DUAL-WRITTEN) | **48 columns, 47 rows.** The original flat site table. Stores brochure content: domain, display name, colors, chatbot greeting, 6 buttons, SEO text, contact form fields, affiliate tags, privacy/terms text, image URLs, template config, hosting_type. **Code says:** `rds_manager/handler.py` (line 10) explicitly marks this as "Legacy tables (deprecated, for backward compatibility only)". The `create_site_record` legacy action still writes to it, and new taxonomy actions also dual-write (line 613-627). Connect Gateway has full CRUD API at `/api/v1/sites` (lines 2984-3500). **Relationship to `website_data`:** The content stored here as individual columns (colors, buttons, SEO, images) is being migrated into `website_data.site_content` JSONB. That's why `website_data` has 82 rows (all websites) while `sites` has 47 (only old creation flow). **Status:** Legacy but cannot drop — still actively read/written by Connect Gateway and Radius. **UID migration impact:** `site_uid` and `s3_folder` columns contain SN- values — included in [UID-Migration-Plan.md](UID-Migration-Plan.md) Step 12. | **MEDIUM — LEGACY, DOCUMENT** `LIVE` |
| ~~S19b~~ | ~~`site_infrastructure` table — ORPHAN~~ | **RESOLVED.** Dropped from `shopnet_sites` on Feb 7, 2026. Was 24 columns, 47 rows — almost entirely NULL/"pending". Built for Radius provisioning pipeline (Route53, ACM, CloudFront lifecycle) which is NOT deployed on live server. Removed: (1) `DROP TABLE site_infrastructure CASCADE` on RDS, (2) infrastructure + site_builds side-queries from `get_site()` endpoint, (3) entire SITE INFRASTRUCTURE ENDPOINTS section (~120 lines: GET + PUT `/api/v1/sites/{domain}/infrastructure`). Both live server and local repo cleaned. Zero callers confirmed. Console Site Edit Modal handles `infrastructure = null` gracefully. shopnet_sites went from 8→7 tables. Backup: `shopnet_connect_api.py.backup-pre-infra-drop-20260207`. | **RESOLVED** `LIVE+LOCAL` |
| ~~S19e~~ | ~~`site_builds` — ORPHAN API ENDPOINTS~~ | **RESOLVED.** Removed 3 dead endpoints from `shopnet_connect_api.py` on Feb 8, 2026 (~130 lines): `GET /api/v1/sites/{domain}/builds` (list_site_builds), `POST /api/v1/sites/{domain}/build` (trigger_site_build), `PUT /api/v1/sites/{domain}/builds/{build_number}` (update_build_status). All queried a `site_builds` table that never existed on RDS — built for Radius (not deployed). `get_builds_summary()` kept (queries `website_data`, used by KPI Dashboard). Both live server and local repo cleaned. `rds_manager/handler.py` doc comment updated. Confirmed: dead endpoints return 404, builds/summary still works. | **RESOLVED** `LIVE+LOCAL` |
| S19c | `taxonomy_hosting_defaults` table — hosting type lookup (ACTIVE, CURRENT) | **~11 columns, 5 rows.** Reference table mapping hosting types to default taxonomy values. Not legacy — built as part of Feb 2026 dynamic taxonomy work. **5 rows:** `lambda` → (W, CO, L, D, lambda, api_gateway), `radius` → (W, CP, R, P, nginx, ec2), `wordpress` → (W, WP, M, P, php, ec2), `shopify` → (W, SH, E, P, external, external), `woocommerce` → (W, WW, E, P, php, external). **Used by:** `get_hosting_taxonomy()` in `shopnet_connect_api.py` (line 3095) and Radius handler (line 115). When a new endpoint is created, hosting_type is looked up here to auto-fill endpoint_type, platform_type, managed_by, persistence, runtime, host. Both code locations have a hardcoded Python dict fallback (line 3086) if table is unreachable. **Status:** Active, current, low risk. Part of the taxonomy system but not mentioned in governance docs yet. Should be documented in architecture docs as the bridge between the old `hosting_type` concept and the new taxonomy fields. | **LOW — DOCUMENT** `LIVE` |
| ~~S19d~~ | ~~`admin_users` table — authentication (ORPHANED COPY)~~ | **RESOLVED.** Orphaned copy dropped from `shopnet_sites` on Feb 7, 2026. Was 8 columns, 1 row (`admin@shopnet.network`), used by nothing — Connect Gateway KPI auth reads from `KPI_Source.admin_users` via `get_kpi_db_connection()`. Two real copies remain: (1) `shopnet_data.admin_users` (16-col full auth, used by data.shopnet), (2) `KPI_Source.admin_users` (8-col simple auth, used by Connect Gateway KPI endpoints). | **RESOLVED** `LIVE` |
| ~~S20~~ | ~~`update-taxonomy-v3.5.sql` had 7 orphan agent_type rows~~ | **RESOLVED.** Removed 7 `agent_type` INSERT lines from `update-taxonomy-v3.5.sql` on Feb 8, 2026. Codes (domain, product, content, kpi, site, choice, custom) didn't match actual values anywhere — `endpoint_taxonomy.agent_type` uses `product_assist`/`domain_assist`/`status_agent`, `shopnet_assist.agents.agent_type` uses `internal`/`client`. No trigger or CHECK ever referenced these codes. SQL file now defines 80 rows (79 active + 1 inactive `gateway`). Also fixed ThisIsTheLaw_v5.0: Section 2.6 rewritten to document the REAL `endpoint_taxonomy.agent_type` values, Appendix B note updated (87→80 rows), Appendix agent_type section replaced with removal note. Library copy synced. | **RESOLVED** `LOCAL CODE+DOC` |
| S21 | Remaining hardcoded CHECKs should be dynamic | Live has 6 hardcoded CHECK constraints: `chk_site_uid_format`, `chk_web_protocol`, `chk_status`, `chk_persistence`, `chk_store_checkout`, `chk_health_method`. Only `endpoint_type`, `managed_by`, and `platform_type` are dynamic (via triggers + `taxonomy_definition`). Consider migrating the rest to dynamic validation for consistency. | **FUTURE** `LIVE` |
| ~~S22~~ | ~~`site_uid VARCHAR(12)` confirmed on live — blocks v2 UIDs~~ | **PLANNED.** Fully scoped in [UID-Migration-Plan.md](UID-Migration-Plan.md) Phase B Steps 5-7 (widen to VARCHAR(15), drop v1 CHECK, add v2 CHECK after batch conversion). Part of the SND Namespace Switchover — all v1 UIDs (SN-/SA-) converted to v2 (sn_/sa_). See also [UID-Migration-Scope.md](UID-Migration-Scope.md). | **PLANNED** `LOCAL+LIVE` |
| ~~S23~~ | ~~`ThisIsTheLaw_v5.0` document says 88 rows — should be 79 (live)~~ | **RESOLVED.** Fixed 88→79 in 5 locations in ThisIsTheLaw_v5.0. Also fixed endpoint_type from "7 rows, 1 inactive" to "6 rows" (ND intentionally excluded). Marked agent_type sections as NOT DEPLOYED. | **RESOLVED** `LOCAL DOC` |
| ~~S24~~ | ~~`github_cards` table is dead code — DB-driven system never wired up~~ | **19 columns, 7 rows.** Created Jan 25, never synced. The `panel-github-library` GUI uses **hardcoded HTML** (index.html lines 2409-2785, ~21 cards across 6 sections) — NOT the database. The DB-driven system was built but never connected: `loadGitHubModules()` in console.js (line 1906) looks for a `github-modules-container` div that **does not exist** in the HTML. **Dead code inventory:** (1) `github_cards` table on RDS — 7 rows, all `repo_name` pointing to wrong org `github.com/anthropics/...` (should be `Timlemmon`). (2) `app.py` lines 1429-1518 — 3 API endpoints (`GET /api/github/cards`, `GET /api/github/cards/<id>`, `POST /api/github/cards`). (3) `console.js` — `renderGitHubCard()` (line 1546), `openGitHubDocumentViewer()` (line 1649), `renderDocumentContent()` (line 1714), `loadGitHubModules()` (line 1906). Also has wrong org fallback at line 1680: `github.com/anthropics/`. **Decision needed:** Drop the table + dead JS/API code, or wire it up properly to replace the hardcoded HTML. The hardcoded HTML works fine and links to the correct `Timlemmon` org. | **RESOLVED** `LIVE+LOCAL CODE` |
| ~~S24a~~ | ~~`panel-github-library` has stale links and version references~~ | The hardcoded HTML panel has **2 broken/stale links:** (1) Line 2734: Card "THIS IS THE LAW v4.0" links to `shopnet.network-library/blob/main/ThisIsTheLaw.md` — THE LAW is now v5.0 and lives in `taxonomy.shopnet` repo, not library root. (2) Line 2720: Card "Deathstar Architecture v5.0" links to `shopnet.network-library/blob/main/SHOPNET-DEATHSTAR.md` — no such file at root; Deathstar docs are in `shopnet-deathstar/` subfolder. **Working links (verified against local library repo):** `connect-client/` ✓, `network-console/BROCHURE-SITES-LAMBDA-ARCHITECTURE.md` ✓, `network-console/ShopnetUniverse.md` ✓, `network-console/RADIUS-ARCHITECTURE.md` ✓, `policies-procedures/` ✓. **Standalone repo links** (connect.shopnet, search.shopnet-module, data.shopnet, kpi-dashboard-module, productassist-ShopifyV1, domainassist-WPWooV2, contentassist-agent) — all match local repos ✓. **Also:** 6 "Planned/Inactive" placeholder cards (Brochure Site Template, Brochure Client Plugin, 4 Store Site Templates) have no links — just static placeholders. All "Updated" dates are hardcoded "Feb 6, 2026" or "Jan 22, 2026" — not live. | **RESOLVED** `LOCAL CODE` |

### FUTURE — Not Yet Designed

| # | Item | Details | Status |
|---|------|---------|--------|
| S13 | Create `shopnet_payments` database | sp_ prefix routes to this database but no schema exists yet. | **FUTURE** `LIVE` |
| S14 | Build assist.shopnet backend | Agent engine (~500 lines estimated). Routes, providers, context assembly. Planned in `/assist.shopnet/TODO.md`. | **FUTURE** `LOCAL CODE` |
| S15 | Build `taxonomy_definition` equivalent for `shopnet_crm` | CRM database has NO lookup/definition table. Valid values for auth_provider, status, role, scope are hardcoded as column defaults or unconstrained. Need a definition table + dynamic validation like shopnet_sites has. | **FUTURE** `LOCAL+LIVE` |
| S16 | Build `taxonomy_definition` equivalent for `shopnet_assist` | Assist database uses MySQL ENUM types in DDL (agent_type, status, model_tier). Need PostgreSQL CHECK constraints or a definition table for dynamic validation. agent_skill values (code, chat, content, data, documents, promotion) are completely unconstrained. | **FUTURE** `LOCAL+LIVE` |
| S17 | Build `taxonomy_definition` equivalent for `shopnet_registry` | Registry database has NO constraints on list_type or status values. Need a definition table or CHECK constraints. | **FUTURE** `LOCAL+LIVE` |

### UNRESOLVED QUESTIONS (Need Decision)

| # | Question | Context | Status |
|---|----------|---------|--------|
| ~~Q1~~ | ~~`store_checkout` values~~ | **RESOLVED.** Live database is definitive: `CHAR(1)` with CHECK constraint `(Y, N)` or NULL. Deathstar Master's "affiliate/checkout/both/none" is **wrong** — those were a documentation error, never implemented. The column is a simple boolean flag: Y = site has checkout capability, N = brochure/affiliate only, NULL = not applicable (non-website). The Deathstar docs should be corrected to match live. | **RESOLVED** `LOCAL DOC + LIVE` |
| Q2 | `CU` vs `CA` for Custom Agent | `platform-types.js` (v3.1) uses `CU`. Everything else uses `CA`. SQL trigger only accepts `CA`. **Decision: `CA` wins.** S1/S2 need updating. | **DECIDED** — `CA` is correct |
| ~~Q3~~ | ~~`W3` vs `L3` for Web3 Website~~ | Per `endpoint-taxonomy-update.MD` line 534: W3 was fixed to L3 in fallback and getPulseMethod(). Now consistent as `L3` everywhere. | **RESOLVED** |

---

## PART 2 — DOCUMENTATION FIXES

### HIGH — Governance Documents Still Referencing `ND`

| # | Document | Location | Current Version | What Needs Changing | Status |
|---|----------|----------|----------------|-------------------|--------|
| ~~D1~~ | ~~THIS IS THE LAW~~ | `/shopnet-deathstar/26-THIS-IS-THE-LAW.md` | v4.0→**v4.1** | **RESOLVED.** Replaced all 13 ND references with N/I/O split. Updated all platform_type tables (W: 9 types, A: CU→CA, D: +DY/GIT/TPD, N: 6 types, I: 9 types, O: 1 type). Added managed_by E. Updated CHECK constraints with dynamic trigger note. Updated diagrams, field matrix, taxonomy tree. | **RESOLVED** `LOCAL DOC` |
| ~~D2~~ | ~~Deathstar Master~~ | `/shopnet-deathstar/Shopnet-Deathstar-Master.MD` | v5.0→**v5.0** | **RESOLVED.** Section 21.2.2 (line 7190): Updated taxonomy hierarchy table — endpoint_type now W/A/D/N/I/O, platform_type now 35 types across all 6 types, managed_by added E, store_checkout corrected to Y/N. Added v5.0 cross-reference. | **RESOLVED** `LOCAL DOC` |
| ~~D3~~ | ~~Deathstar LITE~~ | `/shopnet-deathstar/Shopnet-Deathstar-LITE.md` | v2.1→**v2.2** | **RESOLVED.** Section 2: Updated taxonomy (N/I/O, 35 platform_types, managed_by E). Section 9: Pulse check types 7→11 (added http_ip, http_web3, github, fileserver, none). Section 12: Updated metrics. Updated doc index (Doc 26 v4.1, Doc 42 v1.2). | **RESOLVED** `LOCAL DOC` |

### MEDIUM — Build the Master Taxonomy Document

| # | Item | Details | Status |
|---|------|---------|--------|
| ~~D4~~ | ~~Create `ThisIsTheLaw_v5.0_2026-02-07.MD`~~ | Created and verified against all code sources. 8 Parts + OLD VERSION ARCHIVE + 5 Appendices. Full v2 API surface documented. All errors corrected via cross-reference verification on Feb 7. | **RESOLVED** |

### LOW — Copies That Need Syncing After Primary Updates

| # | Document | Location | Action | Status |
|---|----------|----------|--------|--------|
| ~~D5~~ | ~~Library copy of Doc 26~~ | `/shopnet.network-library/shopnet-deathstar/26-THIS-IS-THE-LAW.md` | **RESOLVED.** Synced from primary after D1 (cp). | **RESOLVED** `LOCAL DOC` |
| ~~D6~~ | ~~Library copy of Doc 47~~ | `/shopnet.network-library/shopnet-deathstar/47-ThisIsTheLaw.md` | **RESOLVED.** File removed from library (was deleted as part of consolidation to v5.0). | **RESOLVED** `LOCAL DOC` |
| ~~D7~~ | ~~Library copy of taxonomy~~ | `/shopnet.network-library/taxonomy.shopnet/ThisIsTheLaw.md` | **RESOLVED.** Replaced with `ThisIsTheLaw_v5.0_2026-02-07.MD` in library. | **RESOLVED** `LOCAL DOC` |
| ~~D8~~ | ~~Console copy of Doc 47~~ | `/shopnet.network-console/docs/47-THIS-IS-THE-SND-LAW.md` | **RESOLVED.** Moved to `taxonomy.shopnet/OLD Versions/47-THIS-IS-THE-SND-LAW_console-copy.md`. | **RESOLVED** `LOCAL DOC` |
| ~~D9~~ | ~~Home directory copy~~ | `~/ThisIsTheLaw.md` | **RESOLVED.** Deleted by user. | **RESOLVED** `LOCAL DOC` |
| ~~D10~~ | ~~FixingTheLaw.MD~~ | `/taxonomy.shopnet/FixingTheLaw.MD` | Superseded header added, pointing to `ThisIsTheLaw_v5.0_2026-02-07.MD`. | **RESOLVED** |

---

## NEW — Code Files Added by Feb 7 Dynamic Update

These were created/modified by the other Claude session and are now part of the system. They are NOT broken — listed here for the file inventory.

| File | Location | What It Does | Status |
|------|----------|-------------|--------|
| `app.py` (Flask route) | `/shopnet.network-console/app.py` (~line 803) | `GET /api/brochure/taxonomy-definitions/platform-options` — serves taxonomy_definition data to console wizard | **LIVE** |
| `loadPlatformOptions()` | `/shopnet.network-console/static/js/console.js` (~line 3834) | Fetches platform options from Flask API, overwrites hardcoded fallback | **LIVE** |
| Dynamic trigger | `validate_platform_type()` on RDS `shopnet_sites` | Reads from `taxonomy_definition` table instead of hardcoded IF/ELSE | **LIVE** |
| Dynamic trigger | `validate_endpoint_type()` on RDS `shopnet_sites` | Validates endpoint_type against `taxonomy_definition` (replaced old CHECK constraint) | **LIVE** |
| Dynamic trigger | `validate_managed_by()` on RDS `shopnet_sites` | Validates managed_by against `taxonomy_definition` (replaced old CHECK constraint) | **LIVE** |

---

## LIVE SYSTEM VERIFICATION RESULTS (Feb 7, 2026)

Queried production RDS directly via SSH → psql. All results below are from the **actual running databases**, not from code files.

### What Matches (Code = Live)
- `taxonomy_definition`: 35 platform_types confirmed (9W + 5A + 5D + 9I + 6N + 1O)
- `managed_by`: 4 values (E, L, M, R) — matches code and document
- All 3 dynamic triggers live: `validate_endpoint_type()`, `validate_managed_by()`, `validate_platform_type()`
- `uid_registry` schema: matches corrected document (SMALLINT DEFAULT 1, VARCHAR(10), VARCHAR(50) NOT NULL)
- `loadPlatformOptions()` and Flask API route both confirmed live

### What Does NOT Match (Code ≠ Live)
| Finding | Code/Doc Says | Live System Has | Impact |
|---------|--------------|-----------------|--------|
| `taxonomy_definition` row count | Document says 88, SQL file has ~87 | **79 rows** (no agent_type, no ND, no inactive gateway) | S23: Fix document |
| `endpoint_taxonomy` columns | `schema_the_law.sql` defines 17 cols | **31 columns** (14 for pulse/display/console not in SQL) | S18: Update SQL |
| Tables in `shopnet_sites` | Document shows 5 tables | **9 tables** (4 undocumented: sites, site_infrastructure, taxonomy_hosting_defaults, admin_users) | S19: Document or deprecate |
| `site_uid` width | Document says VARCHAR(15) for v2 | **VARCHAR(12)** with CHECK `^SN-[0-9]{8}$` (v1 only) | S22: ALTER TABLE needed |
| S8 CHECK constraint | TODO said `(W,A,D,N,I,O,ND)` | **Removed** — replaced by dynamic trigger. No ND anywhere. | S8: Corrected |
| S9 ND records | TODO said "need migration" | **Zero ND records** — 76 endpoints, all properly typed | S9: Resolved |
| S10-S12 databases | TODO said "not created" | **All 3 exist with tables and data** | S10-S12: Resolved |

---

## Summary

| Category | Count | Breakdown |
|----------|-------|-----------|
| **System CRITICAL** | 0 | ~~All resolved~~ |
| **System PLANNED** | 1 | S22 (UID v1→v2 migration — fully scoped in UID-Migration-Plan.md) |
| **System BY DESIGN** | 0 | ~~All resolved~~ |
| **System RESOLVED** | 24 | ~~S1~~ (auto-generated), ~~S2~~ (auto-generated), ~~S3~~ (deleted, dead radius module), ~~S4~~ (deleted with S3), ~~S5~~ (I fallback updated to 9 types), ~~S6~~ (GUI panel rewritten from v5.0), ~~S7~~ (deployed), ~~S8~~ (trigger not CHECK), ~~S9~~ (zero ND records), ~~S10~~ (CRM exists), ~~S11~~ (registry exists), ~~S12~~ (assist exists), ~~S18~~ (schema SQL deleted, live is SOT), ~~S18a~~ (42-PULSE.md updated), ~~S18b~~ (Pulse section added to v5.0), ~~S18c~~ (agent_type investigated — two different columns, both intentional), ~~S19b~~ (site_infrastructure dropped — table + 2 API endpoints + get_site() queries removed), ~~S19d~~ (orphaned admin_users dropped from shopnet_sites), ~~S19e~~ (site_builds orphan endpoints removed — 3 dead endpoints, ~130 lines), ~~S20~~ (7 orphan agent_type rows removed from SQL + ThisIsTheLaw fixed), ~~S23~~ (88→79 fixed), ~~S24~~ (github_cards dead code removed — table dropped, 3 API endpoints + 7 JS functions + modal deleted), ~~S24a~~ (stale links fixed — THE LAW v4.0→v5.0, Deathstar path corrected) |
| **System MEDIUM — DOCUMENT** | 1 | S19a (`sites` table — legacy brochure config, active) |
| **System LOW — DOCUMENT** | 1 | S19c (`taxonomy_hosting_defaults` — hosting lookup, active) |
| **System FUTURE** | 6 | S13-S17 (not yet designed), S21 (dynamic CHECKs) |
| **Questions DECIDED** | 1 | Q2 (CA wins over CU) |
| **Questions RESOLVED** | 2 | ~~Q1~~ (store_checkout = Y/N, live is definitive), ~~Q3~~ (L3 everywhere) |
| **Documentation RESOLVED** | 11 | ~~D1~~ (v4.0→v4.1, ND→N/I/O), ~~D2~~ (Master taxonomy updated), ~~D3~~ (LITE v2.1→v2.2), ~~D4~~ (master doc created), ~~D5~~ (library synced), ~~D6~~ (library Doc 47 removed), ~~D7~~ (library taxonomy replaced with v5.0), ~~D8~~ (console Doc 47 moved to OLD), ~~D9~~ (home copy deleted), ~~D10~~ (superseded) |
| | | |
| **TOTAL OPEN** | **3** | 1 planned + 1 medium + 1 low-doc + 6 future |
| **TOTAL RESOLVED** | **37** | S1-S12, S18, S18a, S18b, S18c, S19b, S19d, S19e, S20, S23, S24, S24a, Q1, Q2, Q3, D1-D10 |

---

**Sources:**
- Code exploration of all HMCG repos (Claude Code, Feb 7 2026)
- `endpoint-taxonomy-update.MD` (other Claude session, Feb 7 2026) — documents dynamic validation deployment
- **LIVE SYSTEM VERIFICATION** (Claude Code, Feb 7 2026) — SSH to `ubuntu@34.234.121.248` → psql to both RDS instances. Queried: `taxonomy_definition` (79 rows confirmed), `endpoint_taxonomy` (31 cols, 76 rows, 0 ND), all CHECK constraints, all triggers, `uid_registry` (89 UIDs: 76 sn + 8 sa + 3 su + 2 sl), all tables in `shopnet_sites` (9), `shopnet_crm` (7 tables, live data), `shopnet_registry` (3 tables, live data), `shopnet_assist` (9 tables, seed data). All databases on both instances confirmed.

**Key code files read:** `platform-types.js`, `schema_the_law.sql`, `seed_the_law.py`, `console.js`, `update-taxonomy-v3.5.sql`, `app.py`, `uid_generator.py`, `uid_registry.py`, `snd_monitor.py`, `crm.py`, `registry.py`, `001_uid_registry.sql`, `002_shopnet_crm.sql`, `003_shopnet_registry.sql`, `DATABASE-DESIGN.md`

**Live System State (Feb 7 2026):**
```
RDS Instance 1: KPI_Source, amazon_products, shopnet_assist (9 tables), shopnet_connect, shopnet_data, shopnet_sites (7 tables)
RDS Instance 2: shopnet_crm (7 tables), shopnet_registry (3 tables)
uid_registry: 89 UIDs (76 sn, 8 sa, 3 su, 2 sl, 0 sp)
endpoint_taxonomy: 76 endpoints (53W, 8A, 6D, 8N, 1I, 0O, 0ND)
taxonomy_definition: 79 rows (35 platform_types, 6 endpoint_types — NO ND)
Dynamic triggers LIVE: validate_endpoint_type, validate_managed_by, validate_platform_type
```
